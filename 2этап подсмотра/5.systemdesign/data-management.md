---
title: Управление данными
sidebar_position: 3
---

## CQRS

CQRS (Command Query Responsibility Segregation) — это шаблон проектирования, который разделяет операции над данными на две категории:

1. Команды:
    - Изменяют состояние системы.
    
Примеры: "Создать заказ", "Обновить товар", "Удалить пользователя".

2. Запросы:
    - Не изменяют состояние системы.
    - Возвращают данные для отображения или обработки.

Примеры: "Получить список товаров", "Просмотреть детали заказа", "Найти пользователя по имени".

### Преимущества:
- Повышение производительности:
    - Отдельные модели для чтения и записи оптимизированы для своих задач.
    - Запросы не блокируют команды и наоборот.
- Улучшенная масштабируемость:
    - Модели можно масштабировать независимо друг от друга.
    - Легче добавить горизонтальное масштабирование для чтения.
- Упрощенная разработка:
    - Четкое разделение обязанностей между моделями.
    - Повышение читабельности и сопровождаемости кода.
    - Повышение безопасности:
    - Разграничение доступа к моделям чтения и записи.
    - Снижение риска случайного изменения данных.

### Недостатки
Увеличенная сложность:
- Требуется проектировать и поддерживать две модели.
- Возможна дубликация кода.
- Необходимость согласованности:
    - Нужно синхронизировать данные между моделями при обновлениях.
    - Возможны проблемы с "непоследовательным чтением".

## Event Sourcing 

Event Sourcing - это шаблон проектирования, в котором все изменения состояния программного приложения фиксируются как последовательность событий в журнале append-only. Это означает, что события добавляются в журнал по мере их возникновения, и существующие записи никогда не изменяются.

Вот некоторые ключевые концепции Event Sourcing:

- **События (Events)**: События - это атомарные единицы изменений, которые произошли в системе. Каждое событие представляет собой факт, произошедший в определенный момент времени, и содержит данные, необходимые для понимания этого факта. Например, событием может быть "Заказ создан" или "Товары добавлены в корзину".
- **Хранилище событий (Event Store)**: Хранилище событий - это специализированная база данных, предназначенная для неизменяемого хранения последовательности событий. В отличие от традиционных баз данных, хранилище событий не перезаписывает существующие данные. Это позволяет просматривать всю историю изменений системы.
- **Проекции (Projections)**: Проекции - это механизм, который используется для создания представлений данных из последовательности событий. Поскольку сырые данные событий могут быть громоздкими для запросов, проекции материализуют данные таким образом, чтобы их можно было эффективно читать. 

Существуют различные типы проекций, которые могут использоваться для разных целей, например, для отображения текущего состояния сущности или для создания аналитических отчетов.

### Преимущества
- **Аудит-трейл (Audit Trail)**: Поскольку все события сохраняются неизменными, Event Sourcing обеспечивает полный аудит-трейл всех изменений в системе. Это может быть полезно для отладки, обеспечения соответствия требованиям и анализа бизнес-процессов.
- **Воспроизводимость (Reproducibility)**: С помощью последовательности событий можно воспроизвести состояние системы на любой момент времени. Это позволяет отслеживать ошибки, тестировать различные сценарии и повторно запускать вычисления.
- **Масштабируемость (Scalability)**: Event Sourcing хорошо подходит для распределенных систем, поскольку события могут легко публиковаться и подписываться различными компонентами системы.

### Недостатки
- **Сложность (Complexity)**: Реализация Event Sourcing может быть более сложной, чем традиционные подходы к управлению данными. Необходимо тщательно продумывать, как представлять события, создавать и обновлять проекции.
- **Запросы (Queries)**: Запросы к данным в системе Event Sourcing могут быть менее эффективными, чем запросы к традиционной базе данных. Это связано с тем, что для получения текущего состояния сущности может потребоваться реконструкция из последовательности событий.

## Sharding / Partitioning

Шардинг и партицирование – это два метода масштабирования баз данных, которые позволяют распределять данные по нескольким серверам.

Шардинг (от англ. shard – осколок) – это горизонтальное масштабирование, при котором данные одной таблицы разделяются на несколько частей, называемых шардами.

Партицирование (от англ. partition – раздел) – это метод, при котором данные одной таблицы разделяются на несколько логических частей, называемых партициями.

### В чем же разница?

Шардинг – это более низкоуровневый метод, который работает на уровне физических серверов.  При шардинге данные распределяются по разным серверам, и каждый сервер хранит только часть данных.

Партицирование – это более высокоуровневый метод, который работает на уровне логических разделов.  При партицировании данные одной таблицы разделяются на несколько логических частей, но эти части могут храниться на одном сервере.

### Преимущества шардинга
- **Горизонтальное масштабирование**: Шардинг позволяет масштабировать базу данных по горизонтали, добавляя новые серверы.
- **Улучшение производительности**: Шардинг может улучшить производительность за счет распределения нагрузки между несколькими серверами.
- **Повышение доступности**: Шардинг может повысить доступность базы данных, поскольку при выходе из строя одного сервера остальные серверы будут продолжать работать.

### Недостатки шардинга
- **Сложность**: Шардинг может быть более сложным в реализации и управлении, чем партицирование.
- **Необходимость репликации**: Для обеспечения доступности данных при шардинге необходимо реплицировать данные на несколько серверов.

### Преимущества партиционирования
- **Простота**: Партицирование проще в реализации и управлении, чем шардинг.
- **Улучшение производительности**: Партицирование может улучшить производительность за счет разделения данных на логические части.
- **Повышение доступности**: Партицирование может повысить доступность базы данных, поскольку при выходе из строя одной части данных остальные части будут продолжать работать.

### Недостатки партиционирования
- **Ограниченная масштабируемость**: Партицирование не позволяет масштабировать базу данных по горизонтали так же эффективно, как шардинг.
- **Сложность запросов**: Запросы к данным, которые разделены на несколько партиций, могут быть более сложными.