## Channels
**channel** - –º–µ—Ö–∞–Ω–∏–∑–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏(—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω), —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ heap.
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** 
![[Pasted image 20250104210716.png]]
## –¢–∏–ø –∫–∞–Ω–∞–ª–æ–≤
1. –ë—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π(first in - first out)
2. –ù–µ–±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π(first in - first out –∏–ª–∏ first in - last out, –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –±—É—Ñ–µ—Ä–µ)
3. –û–¥–Ω–æ–Ω–∞–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ
4. –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã–µ
## –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
- –°–æ–∑–¥–∞–Ω–∏–µ/–æ—Ç–∫—Ä—ã—Ç–∏–µ:
	```go
	ch := make(chan int)       // –±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –Ω–∞ 0 (–±–µ–∑ –±—É—Ñ–µ—Ä–∞)
	chBuf := make(chan int, 3) // –±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –Ω–∞ 3 —ç–ª–µ–º–µ–Ω—Ç–∞
	```
-  –ó–∞–ø–∏—Å—å:
```go
 ch <- 42
```
- –ß—Ç–µ–Ω–∏–µ:
```go
value := <-ch
```
- –ó–∞–∫—Ä—ã—Ç–∏–µ:
```go
close(ch)
```
- –ß—Ç–µ–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π, –æ—Ç–∫—Ä—ã—Ç –ª–∏ –∫–∞–Ω–∞–ª:
```go
value, ok := <-ch
if ok {
    fmt.Println("–ü—Ä–æ—á–∏—Ç–∞–Ω–æ:", value)
} else {
    fmt.Println("–ö–∞–Ω–∞–ª –∑–∞–∫—Ä—ã—Ç")
}
```
- range
```go
for v := range ch { //—Å–∞–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ
    fmt.Println(v)
}
```
- select
```go
select {
case v := <-ch1:
    fmt.Println("ch1:", v)
case v := <-ch2:
    fmt.Println("ch2:", v)
}
//—Ä–∞–Ω–¥–æ–º–Ω–æ –≤—ã–±–∏—Ä–∞–µ—Ç –ª—é–±–æ–π –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö case, –∏–ª–∏ –æ–∂–¥–∞–µ—Ç –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ
//–¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ(–µ—Å–ª–∏ –µ—Å—Ç—å default, –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –æ–Ω)
```
![[Pasted image 20250609185524.png]]

## –ë—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
–ò–º–µ—é—Ç –∫–æ–ª—å—Ü–µ–≤—É—é –æ—á–µ—Ä–µ–¥—å –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏(FIFO + –∏—Å–∫–ª LIFO –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ–º –±—É—Ñ–µ—Ä–µ):
	![[bufered_channels.jpg]]
## –ü—Ä–æ–±–ª–µ–º—ã/–û—à–∏–±–∫–∏

–ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–∞–Ω–∞–ª–æ–≤ –∏ –≥–æ—Ä—É—Ç–∏–Ω –≤ Go –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –∏–∑-–∑–∞:
1. **–ì–æ–Ω–æ–∫ –¥–∞–Ω–Ω—ã—Ö (Data races)**: –ù–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –æ–±—â–∏–º –¥–∞–Ω–Ω—ã–º –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω.
2. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (Deadlocks)**: –ö–æ–≥–¥–∞ –≥–æ—Ä—É—Ç–∏–Ω—ã –∂–¥—É—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞, –Ω–æ –Ω–∏ –æ–¥–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
3. **–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏**: –û—à–∏–±–∫–∏ –≤ –≥–æ—Ä—É—Ç–∏–Ω–∞—Ö –º–æ–≥—É—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–µ–∑–∞–º–µ—á–µ–Ω–Ω—ã–º–∏, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
4. **–ù–µ–≤–µ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤**: –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –∫–∞–Ω–∞–ª –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω –∏–ª–∏ –ø—É—Å—Ç.
5. **–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–∫—Ä—ã—Ç–∏—è –∫–∞–Ω–∞–ª–∞**: –ï—Å–ª–∏ –∫–∞–Ω–∞–ª –Ω–µ –∑–∞–∫—Ä—ã—Ç –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –¥—Ä—É–≥–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –º–æ–≥—É—Ç –∑–∞–≤–∏—Å–∞—Ç—å, –æ–∂–∏–¥–∞—è –¥–∞–Ω–Ω—ã—Ö.
## –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏

### **üìå –ü–æ—á–µ–º—É –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤ –∫–∞–Ω–∞–ª–µ?**

–í Go **–∫–∞–Ω–∞–ª—ã (`chan`) —Ä–∞–±–æ—Ç–∞—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ**, –µ—Å–ª–∏ –æ–Ω–∏ **–Ω–µ –±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω—ã**. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ:

1. **–û—Ç–ø—Ä–∞–≤–∫–∞ (`chan <- value`) –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è**, –µ—Å–ª–∏ **–≤ –∫–∞–Ω–∞–ª–µ –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞**.
2. **–ß—Ç–µ–Ω–∏–µ (`<- chan`) –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è**, –µ—Å–ª–∏ **–∫–∞–Ω–∞–ª –ø—É—Å—Ç**.

üîπ –í –¥–∞–Ω–Ω–æ–º –∫–æ–¥–µ:

```go
res := make(chan int) // ‚ùå –ö–∞–Ω–∞–ª –±–µ–∑ –±—É—Ñ–µ—Ä–∞ (–±—É—Ñ–µ—Ä = 0)
res <- rand.Int()     // ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞! –ù–∏–∫—Ç–æ –Ω–µ —á–∏—Ç–∞–µ—Ç –∏–∑ –∫–∞–Ω–∞–ª–∞
fmt.Printf("%d", <-res) // –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è
```

- **–û—Ç–ø—Ä–∞–≤–∫–∞ `res <- rand.Int()` –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**, –ø–æ—Ç–æ–º—É —á—Ç–æ **–Ω–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è**, –∫–æ—Ç–æ—Ä—ã–π –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –≥–æ—Ç–æ–≤ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ.
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ **deadlock'—É**.

---

## **üìå –ö–∞–∫–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ–ª—è –æ—Ç–≤–µ—á–∞—é—Ç –∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –≤ –∫–∞–Ω–∞–ª–µ?**

–í–Ω—É—Ç—Ä–∏ **Go Runtime –∫–∞–Ω–∞–ª (`chan`)** –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π `hchan` (internal runtime —Å—Ç—Ä—É–∫—Ç—É—Ä–∞).

üìå –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è:

|–ü–æ–ª–µ|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|
|**`qcount`**|–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∫–∞–Ω–∞–ª–µ|
|**`dataqsize`**|–†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ (0 –¥–ª—è –Ω–µ–±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤)|
|**`buf`**|–£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö (–±—É—Ñ–µ—Ä)|
|**`sendx`**|–ò–Ω–¥–µ–∫—Å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –≤ –±—É—Ñ–µ—Ä|
|**`recvx`**|–ò–Ω–¥–µ–∫—Å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —á—Ç–µ–Ω–∏—è –∏–∑ –±—É—Ñ–µ—Ä–∞|
|**`sendq`**|–û—á–µ—Ä–µ–¥—å –≥–æ—Ä—É—Ç–∏–Ω, –æ–∂–∏–¥–∞—é—â–∏—Ö –æ—Ç–ø—Ä–∞–≤–∫—É|
|**`recvq`**|–û—á–µ—Ä–µ–¥—å –≥–æ—Ä—É—Ç–∏–Ω, –æ–∂–∏–¥–∞—é—â–∏—Ö —á—Ç–µ–Ω–∏–µ|

---

## **üìå –ö–∞–∫ —ç—Ç–∏ –ø–æ–ª—è —Å–≤—è–∑–∞–Ω—ã —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π?**

1. –ï—Å–ª–∏ **`qcount == dataqsize` (–±—É—Ñ–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω)** ‚Üí **–Ω–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (`sendq`) –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è**.
2. –ï—Å–ª–∏ **`qcount == 0` (–∫–∞–Ω–∞–ª –ø—É—Å—Ç)** ‚Üí **—á—Ç–µ–Ω–∏–µ (`recvq`) –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è**.
3. –ï—Å–ª–∏ –∫–∞–Ω–∞–ª **–Ω–µ–±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω (`dataqsize == 0`)**, —Ç–æ **–∫–∞–∂–¥–æ–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ —á—Ç–µ–Ω–∏—è**.

---

## **üìå –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏?**

‚úÖ **–ë—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª (`make(chan int, N)`)**

- –ï—Å–ª–∏ `dataqsize > 0`, –∑–∞–ø–∏—Å—å **–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –ø–æ–∫–∞ –µ—Å—Ç—å –º–µ—Å—Ç–æ**.

```go
res := make(chan int, 1) // ‚úÖ –ï—Å—Ç—å –º–µ—Å—Ç–æ –¥–ª—è 1 —ç–ª–µ–º–µ–Ω—Ç–∞
res <- rand.Int()        // ‚úÖ –ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–∞, –¥–∞–∂–µ –±–µ–∑ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è
fmt.Println(<-res)       // ‚úÖ –ß–∏—Ç–∞–µ–º
```

‚úÖ **–ì–æ—Ä—É—Ç–∏–Ω—ã (`go func() {}`)**

- –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø—Ä–∏—ë–º –∏–¥—É—Ç –≤ **—Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω–∞—Ö**, –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.

```go
res := make(chan int)
go func() {
    res <- rand.Int() // ‚úÖ –ó–∞–ø–∏—Å—å –≤ –¥—Ä—É–≥–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç main)
}()
fmt.Println(<-res) // ‚úÖ –ß–∏—Ç–∞–µ–º (—Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É)
```

‚úÖ **–í—ã–±–æ—Ä `select` –¥–ª—è –Ω–µ–Ω–∞–¥—ë–∂–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤**

- –ï—Å–ª–∏ –º—ã –Ω–µ —É–≤–µ—Ä–µ–Ω—ã, –±—É–¥–µ—Ç –ª–∏ —á—Ç–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `select`.

```go
select {
case res <- rand.Int():
    fmt.Println("Sent!")
default:
    fmt.Println("Channel is full, skipping send")
}
```

---

## **üìå –ò—Ç–æ–≥**

|–°–∏—Ç—É–∞—Ü–∏—è|–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞?|–ü–æ–ª—è `hchan`, –æ—Ç–≤–µ—á–∞—é—â–∏–µ –∑–∞ —ç—Ç–æ|
|---|---|---|
|**–ö–∞–Ω–∞–ª –ø—É—Å—Ç, –Ω–æ –∫—Ç–æ-—Ç–æ —Ö–æ—á–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å (`<-ch`)**|‚úÖ –î–∞ (–æ–∂–∏–¥–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏)|`qcount == 0`|
|**–ö–∞–Ω–∞–ª –ø–æ–ª–æ–Ω, –Ω–æ –∫—Ç–æ-—Ç–æ —Ö–æ—á–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å (`ch <-`)**|‚úÖ –î–∞ (–æ–∂–∏–¥–∞–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è)|`qcount == dataqsize`|
|**–ö–∞–Ω–∞–ª –±–µ–∑ –±—É—Ñ–µ—Ä–∞, –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –±–µ–∑ —á–∏—Ç–∞—Ç–µ–ª—è (`ch <-`)**|‚úÖ –î–∞ (–∂–¥—ë—Ç —á—Ç–µ–Ω–∏—è)|`dataqsize == 0`, `sendq`|
|**–ö–∞–Ω–∞–ª —Å –±—É—Ñ–µ—Ä–æ–º (`make(chan int, N)`) –∏ —Å–≤–æ–±–æ–¥–Ω—ã–º –º–µ—Å—Ç–æ–º**|‚ùå –ù–µ—Ç (–∑–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–∞)|`qcount < dataqsize`|
|**–ì–æ—Ä—É—Ç–∏–Ω–∞ —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (`go func() { <-ch }`)**|‚ùå –ù–µ—Ç (—Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∫–∞)|`recvq`|

